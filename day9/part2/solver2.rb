s=[*$<]*'';s=(s+?9*w=1+(s=~/$/)).tr$/,?9;f=->i{s[i]>?8?0:(s[i]=?9;1+[1,-1,w,-w].sum{f[i+_1]})};p (0..w*$.).map{f[_1]}.max(3).inject:*